# Набор скриптов, которые копировал и дописывал из проекта в проект.

## ajax_forms

Аякс (на самом деле fetch, jquery не нужен) формы.

Используется как.
JS
```javascript
// навешиваем на конкретную форму
let myForm = new AjaxForm(form)

// или на все какие хотим
document.querySelectorAll(".ajax-form").forEach(f => new AjaxForm(f))

// можем перенастроить.
myForm.onSuccess = (...args) => {
	// вызвать стандартный
	AjaxForm.prototype.onSuccess.apply(myForm, args)
	// и дописать свой код
}

// и так далее
myForm.onError = () => {}
myForm.onBeforeSend = () => {}
myForm.onAfterSend = () => {}


```

HTML в шаблоне компонента.
```html
	<form
		id="someId"
		action="<?=POST_FORM_ACTION_URI?>"
		method="post"
		class="ajax-form"
		data-component="<?=$this->__component->getName()?>"
		data-action="callback"
	>
		<!-- inputs -->
	</form>
```

Формы используют Controllerable от битрикса. Ошибки и ответы сервера пихают в конец формы в `div.success-text` и `div.error-text`. На саму форму в процессе накладываются классы `is-loading, is-success, is-error`. Для того чтобы в ошибке не был весь трейс ошибки надо пользоваться Errorable: `$this->errorCollection[] = new Error("Ошибка без трейса");`

Посмотреть это все можно в компоненте коллбека. Правда там я использую еще и обертку для коллбека, но под капотом у нее именно этот скриптик.

## callback

Ну и собственно эта обертка. Осторожно создает глобальный объект `window.cb`, просто потом что. Отличается от просто аякс формы тем, что у нее есть еще проверка параметров, ну и работа с яндекс метрикой.

## custom_utils

Ничего интересного. Просто мне удобно чтобы на проекте были функции работы с модалками. И они **всегда** назывались одинаково. Просто чтобы остальные скрипты работали.

## global_events

Как навесить скрипт на элемент? Знаю `element.addEventListener(...)`, а если элемент создается скриптом? Ну тогда `document.addEventListener(...)`, а внутри проверить что таргет это нужный элемент. Ну вот этот скрипт делает как раз это. У него есть глобальная переменная `const globalClickHandlers = {"nodeClassName" => callback, ...}`. Знаю что константы можно было именовать как-то по другому. И это все только для кликов. И чуть похитрее. Ведь сработает даже если мы кликнули на элемент вложенный в нужный.

В общем позволяет повесить коллбек клик по динамическому элементу и его потомкам. Ну и видно все это в одном объекте.

## personal_data

Скрипт для работы со списками вида юзер -> товары. А еще с корзиной, если корзина отдает json. Для использования нужно будет менять его код. В теории будет менять циферку внутри баджика с аттрибутам вида `data-favorite-badge`, хотя можно делать свои. И добавлять классы `_active`, `_delete` на ноды с классом `js-addToFavorite`, это все тоже можно менять. Хранит все это еще и в localStorage, пользователи ведь бывают не авторизованные, хотя стоило по аналогии с корзиной использовать fuser. Бек для этого в ln/modules/mkmatrix.main/lib/controller/main.php. А еще для работы вроде необходим еще и скрипт user_list_items, ведь текущий файлик отвечает за начальное получение.

## user_list_items

Уже и не помню зачем, может это часть предыдущего скрипта вынесена в отдельный файл. Но тут запросы непосредственно добавляющие и удаляющие элементы.